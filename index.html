<!DOCTYPE html>
<html>
  <head>
    <title>WatchTracking</title>
    <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

	 <link rel="stylesheet" type="text/css" href="css/button.css"/>

    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" charset="utf-8">
    var nonstop = true;
    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // device APIs are available
    //
    function onDeviceReady() {
    }

    // alert dialog dismissed
    function alertDismissed() {
        // do something
    }

    // Show a custom alertDismissed
    //
    function createTable() {
        $.ajax({
            type: "POST",
            url: "http://watchthekids.esy.es/create_table.php",
            data: { tabla:  $('#tablename').val()}
            })
            .done(function( msg ) {
                alert("Esperando GPS");
                insertCoord();
            })             
            .fail(function(msg ) {
            });
    }    

    function onSuccess(pos) {
        var crd = pos.coords;
        $.ajax({
            type: "POST",
            url: "http://watchthekids.esy.es/insert_coord.php",
            data: { tabla: $('#tablename').val(), lat: crd.latitude, lng:  crd.longitude }
            })
            .done(function( msg ) {
                alert("envia coordenada");
            }
        );
    }

    function GetCurrentPosition() {
        navigator.geolocation.getCurrentPosition(onSuccess);
    }

    function insertCoord() {
        $('#button').css('background','red');
        idinterval = setInterval(GetCurrentPosition, 60000);
    }

    function desactivate () {
        clearInterval(idinterval);
    }

    </script>
  </head>
  <body>
	 <center>
		<form name="form1">
            <input id="tablename" type="text" />
			<div id="button" onClick="createTable()" class="myButton">Activar</div>
            <div id="button2" class="myButton" onclick="desactivate()">Desactivar</div>
		</form>
	 </center>
  </body>
</html>
