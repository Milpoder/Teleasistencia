<!DOCTYPE html>
<html>
  <head>
	<meta charset="UTF-8">
    <title>WatchTracking</title>
    <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/button.css"/>
    <script type="text/javascript" charset="utf-8">
	var coor=[];
	var recar=0;
    function ReadTable() {
            $.ajax({
            	type: "POST",
            	url: "http://watchthekids.esy.es/get_coord.php",
            	data: { tabla:  $('#tablename').val()}})
			.always(function(data){
				datos=data;
				convertiracoordenadas();
			});
 	}

	function convertiracoordenadas(){

		for(i=0; i<datos.length; i++){
			coor.push(new google.maps.LatLng(datos[i].Latitude, datos[i].Longtiude));
		}
	}    

	$(document).ready(function() {
		    if (typeof navigator.geolocation == "undefined") {
		      $("#error").text("Your browser doesn't support the Geolocation API");
		      return;
		    }
	 
		    navigator.geolocation.watchPosition(function(position) {
		    	ReadTable();
	 
			    var myOptions = {
		        	zoom : 16,
		        	center : coor[0],
		        	mapTypeId : google.maps.MapTypeId.ROADMAP
		      	}
		      	var map = new google.maps.Map(document.getElementById("map"), myOptions);
	 
		      	var latLngBounds = new google.maps.LatLngBounds();
		      	for(var i = 0; i < coor.length; i++) {
		        	latLngBounds.extend(coor[i]);
		        	new google.maps.Marker({
		          	map: map,
		          	position: coor[i],
		          	title: "Point " + (i + 1)
		        	});
		      	}
		      	var polyline = new google.maps.Polyline({
		        	map: map,
		        	path: coor,
		        	strokeColor: '#0000FF',
		        	strokeOpacity: 0.7,
		        	strokeWeight: 1
		      	});
		      	map.fitBounds(latLngBounds);
		    	},
		    	function(positionError){
		      		$("#error").append("Error: " + positionError.message + "<br />");
		    	},
		    	{
		      	enableHighAccuracy: true,
		      	timeout: 10 *1000 // 10 seconds
		    	});
			});
    </script>
	<style type="text/css">
      #map {
        width: 1300px;
        height: 500px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
	 <center>
		<form name="form1">
            <input id="tablename" type="text" />
			<div id="button" onClick="ReadTable()" class="myButton">Activar</div>
			<div id="map"></div>
		</form>
	 </center>
  </body>
</html>
